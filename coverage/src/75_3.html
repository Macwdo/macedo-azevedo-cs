<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/home/macwdo/Work/MacedoAzevedo/Macedo-azevedo-cs/Ma.Api.Test/System/UnitTests/Middlewares/GlobalExceptionHandlingMiddlewareTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Ma.API.Middlewares;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.TestHost;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;

namespace Ma.Api.Test.System.UnitTests.Middlewares;

public class GlobalExceptionHandlingMiddlewareTest{

    public GlobalExceptionHandlingMiddlewareTest()
    {
        
    }

    // WIP
    [Fact]
    public async Task GlobalExceptionHandlingMiddlewareTest_ReturnsInternalError()
    {

        // Arrange
        const string errorMessage = &quot;Test Exception&quot;;

        using var host = await new HostBuilder()
            .ConfigureWebHost(webBuilder =&gt;
            {
                webBuilder
                    .UseTestServer()
                    .ConfigureServices(services =&gt;
                    {
                        services.AddControllers();
                        services.AddTransient&lt;GlobalExceptionHandlingMiddleware&gt;();

                    })
                    .Configure(app =&gt;
                        {
                            app.UseRouting();
                            app.UseEndpoints(endpoints =&gt; { endpoints.MapControllers(); });

                            app.UseMiddleware&lt;GlobalExceptionHandlingMiddleware&gt;();
                        }
                    );
            })
            .StartAsync();

        ProblemDetails problem = new()
        {
            Status = StatusCodes.Status500InternalServerError,
            Type = &quot;Error&quot;,
            Title = &quot;Internal Server Error&quot;,
            Detail = errorMessage
        };

        // Act
        var response = await host.GetTestClient().GetAsync(&quot;/registries&quot;);

        // Assert
        // response.StatusCode.Should().Be(HttpStatusCode.InternalServerError);

    }
}


    </pre>
    <script type="text/javascript">
      highlightRanges([[14,5,14,51,0],[15,5,15,6,0],[17,5,17,6,0],[22,5,22,6,0],[27,9,29,13,0],[29,13,29,14,0],[29,14,30,17,0],[30,17,33,21,0],[33,21,33,22,0],[33,22,34,25,0],[34,25,34,51,0],[34,51,35,25,0],[35,25,35,84,0],[35,84,37,21,0],[37,21,37,22,0],[37,22,39,25,0],[39,25,39,26,0],[39,26,40,29,0],[40,29,40,46,0],[40,46,41,29,0],[41,29,41,59,0],[41,59,41,60,0],[41,60,41,61,0],[41,61,41,88,0],[41,88,41,89,0],[41,89,41,90,0],[41,90,41,92,0],[41,92,43,29,0],[43,29,43,84,0],[43,84,44,25,0],[44,25,44,26,0],[44,26,45,23,0],[45,23,46,13,0],[46,13,46,14,0],[46,14,47,27,0],[49,9,55,11,0],[58,9,58,75,0],[63,5,63,6,0]]);
    </script>
  </body>
</html>