<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/home/macwdo/Work/MacedoAzevedo/Macedo-azevedo-cs/Ma.API/Services/RegistryService.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using AutoMapper;
using FluentValidation;
using Ma.API.Entities;
using Ma.API.Exceptions;
using Ma.API.Models.Registry;
using Ma.API.Repository;

namespace Ma.API.Services;

// TODO: Add Caching
// TODO: Add Logging
// TODO: Add Tests
public class RegistryService: IRegistryService
{
    private readonly IRepository&lt;Registry&gt; _repository;
    private readonly IMapper _mapper;
    private readonly ILogger&lt;RegistryService&gt; _logger;

    private readonly IValidator&lt;CreateRegistryDto&gt; _createRegistryDtoValidator;

    public RegistryService(IRepository&lt;Registry&gt; repository, IMapper mapper, ILogger&lt;RegistryService&gt; logger, IValidator&lt;CreateRegistryDto&gt; createRegistryDtoValidator)
    {
        _repository = repository;
        _mapper = mapper;
        _logger = logger;
        _createRegistryDtoValidator = createRegistryDtoValidator;
    }

    public ReadRegistryDto CreateRegistry(CreateRegistryDto createRegistryDto)
    {

        var result = _createRegistryDtoValidator.Validate(createRegistryDto);
        if (!result.IsValid)
        {
            throw new InvalidModelException(errors: result.Errors.Select(x =&gt; x.ErrorMessage));
        }

        var registryEntity = _mapper.Map&lt;Registry&gt;(createRegistryDto);
        _repository.Create(registryEntity);
        var readRegistryDto = _mapper.Map&lt;ReadRegistryDto&gt;(registryEntity);
        return readRegistryDto;
    }

    public IEnumerable&lt;ReadRegistryDto&gt; GetRegistries()
    {
        var registries = _repository.GetAllReadOnly();
        var readRegistriesDto = _mapper.Map&lt;IEnumerable&lt;ReadRegistryDto&gt;&gt;(registries);
        return readRegistriesDto;
    }

    public ReadRegistryDto? GetRegistry(int id)
    {
        var registryEntity = _repository.Get(id);
        return registryEntity is null ? null : _mapper.Map&lt;ReadRegistryDto&gt;(registryEntity);
    }

    public ReadRegistryDto UpdateRegistry(int id, UpdateRegistryDto updateRegistryDto)
    {
        var registry = _repository.Get(id);
        if (registry is null) throw new NotFoundEntityException(typeof(Registry), id);
        _mapper.Map(updateRegistryDto, registry);
        _repository.Update(registry);
        return _mapper.Map&lt;ReadRegistryDto&gt;(registry);
    }

    public void DeleteRegistry(int id)
    {
        var registry = _repository.Get(id);
        if (registry is not null)
            _repository.Delete(registry);
        else
            throw new NotFoundEntityException(typeof(Registry), id);
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[21,5,21,168,0],[22,5,22,6,0],[23,9,23,34,0],[24,9,24,26,0],[25,9,25,26,0],[26,9,26,66,0],[27,5,27,6,0],[30,5,30,6,0],[32,9,32,78,0],[33,9,33,29,0],[34,9,34,10,0],[35,13,35,79,0],[35,79,35,93,0],[35,93,35,96,0],[38,9,38,71,0],[39,9,39,44,0],[40,9,40,76,0],[41,9,41,32,0],[42,5,42,6,0],[45,5,45,6,0],[46,9,46,55,0],[47,9,47,87,0],[48,9,48,34,0],[49,5,49,6,0],[52,5,52,6,0],[53,9,53,50,0],[54,9,54,93,0],[55,5,55,6,0],[58,5,58,6,0],[59,9,59,44,0],[60,9,60,30,0],[60,31,60,87,0],[61,9,61,50,0],[62,9,62,38,0],[63,9,63,55,0],[64,5,64,6,0],[67,5,67,6,0],[68,9,68,44,0],[69,9,69,34,0],[70,13,70,42,0],[72,13,72,69,0],[73,5,73,6,0]]);
    </script>
  </body>
</html>