<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/home/macwdo/Work/MacedoAzevedo/Macedo-azevedo-cs/Ma.API/Validators/EntityExistsValidationAttribute.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.ComponentModel.DataAnnotations;
using FluentValidation.Validators;
using Ma.API.Entities;
using Ma.API.Repository;

namespace Ma.API.Validators;

public class EntityExistsValidatorAttribute&lt;TEntity&gt;: ValidationAttribute where TEntity : class
{

    protected override ValidationResult? IsValid(object? value, ValidationContext validationContext)
    {
        var entityRepository = (IRepository&lt;TEntity&gt;)validationContext.GetService(typeof(IRepository&lt;TEntity&gt;))!;
        var entityId = (int?)value;
        if (entityId is null)
            return ValidationResult.Success;

        var entity = entityRepository.Get(entityId.Value);
        if (entity is null)
            return new ValidationResult($&quot;{typeof(TEntity).Name} by id={entityId} does not exist&quot;);

        return ValidationResult.Success;
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[12,5,12,6,0],[13,9,13,114,0],[14,9,14,36,0],[15,9,15,30,0],[16,13,16,45,0],[18,9,18,59,0],[19,9,19,28,0],[20,13,20,100,0],[22,9,22,41,0],[23,5,23,6,0]]);
    </script>
  </body>
</html>