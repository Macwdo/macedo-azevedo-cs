<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/home/macwdo/Work/MacedoAzevedo/Macedo-azevedo-cs/Ma.API/Controllers/GenericCrudControlller.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Ma.API.Exceptions;
using Ma.API.Models;
using Ma.API.Services;
using Microsoft.AspNetCore.Mvc;

namespace Ma.API.Controllers;

public class GenericCrudControlller&lt;TEntity, TCreateDto, TReadDto, TUpdateDto&gt; : ControllerBase
    where TEntity : class
    where TCreateDto : class
    where TReadDto : class
    where TUpdateDto : class
{

    protected readonly IGenericCrudService&lt;TEntity, TCreateDto, TReadDto, TUpdateDto&gt; service;
    public GenericCrudControlller(IGenericCrudService&lt;TEntity, TCreateDto, TReadDto, TUpdateDto&gt; service)
    {
        this.service = service;
    }
    
    [HttpGet]
    public IActionResult GetAll(int skip=1, int take=10)
    {
        var entitiesDto = service.GetAllPaginated(skip, take).ToList();
        var paginationModel = new PaginationModel&lt;TReadDto&gt;(entitiesDto, skip, take, entitiesDto.Count());
        return Ok(paginationModel);
    }
    
    [HttpGet(&quot;{id}&quot;)]
    public IActionResult Get(int id)
    {
        var entityDto = service.Get(id);
        if (entityDto is null)
            return NotFound();
        return Ok(entityDto);
    }
    
    [HttpPost]
    public IActionResult Create(TCreateDto dto)
    {
        try
        {
            var entityDto = service.Create(dto);
            var id = GetIdFromEntityDto(entityDto);
            return CreatedAtAction(nameof(Get), new { id }, entityDto);

        }
        catch (NotFoundEntityException e)
        {
            return NotFound(e.Message);
        }
        catch (InvalidModelException e)
        {
            return BadRequest(e.Message);
        } catch (Exception e)
        {
            throw new ServerErrorException(&quot;Unexpected error trying to create entity&quot;);
        }
    }

    private int GetIdFromEntityDto(TReadDto entityDto)
    {
            var id = entityDto.GetType().GetProperty(&quot;Id&quot;)?.GetValue(entityDto, null);
            return (int)(id ?? throw new ServerErrorException(&quot;Unexpected error trying to get Id from entityDto&quot;));
    }

    [HttpPut(&quot;{id}&quot;)]
    public IActionResult Update(int id, TUpdateDto dto)
    {
        try
        {
            var entityDto = service.Update(id, dto);
            return Ok(entityDto);
        }
        catch (NotFoundEntityException e)
        {
            return NotFound(e.Message);
        }
        catch (InvalidModelException e)
        {
            return BadRequest(e.Message);
        }
        catch (Exception e)
        {
            throw new ServerErrorException(&quot;Unexpected error trying to update entity&quot;);
        }
    }

    [HttpDelete(&quot;{id}&quot;)]
    public IActionResult Delete(int id)
    {
        try
        {
            service.Delete(id);
            return NoContent();
        }
        catch (NotFoundEntityException e)
        {
            return NotFound(e.Message);
        }
        catch (Exception e)
        {
            throw new ServerErrorException(&quot;Unexpected error trying to delete entity&quot;);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,5,16,106,0],[17,5,17,6,0],[18,9,18,32,0],[19,5,19,6,0],[23,5,23,6,0],[24,9,24,72,0],[25,9,25,107,0],[26,9,26,36,0],[27,5,27,6,0],[31,5,31,6,0],[32,9,32,41,0],[33,9,33,31,0],[34,13,34,31,0],[35,9,35,30,0],[36,5,36,6,0],[40,5,40,6,0],[42,9,42,10,0],[43,13,43,49,0],[44,13,44,52,0],[45,13,45,72,0],[48,9,48,42,0],[49,9,49,10,0],[50,13,50,40,0],[52,9,52,40,0],[53,9,53,10,0],[54,13,54,42,0],[55,11,55,30,0],[56,9,56,10,0],[57,13,57,88,0],[59,5,59,6,0],[62,5,62,6,0],[63,13,63,87,0],[64,13,64,116,0],[65,5,65,6,0],[69,5,69,6,0],[71,9,71,10,0],[72,13,72,53,0],[73,13,73,34,0],[75,9,75,42,0],[76,9,76,10,0],[77,13,77,40,0],[79,9,79,40,0],[80,9,80,10,0],[81,13,81,42,0],[83,9,83,28,0],[84,9,84,10,0],[85,13,85,88,0],[87,5,87,6,0],[91,5,91,6,0],[93,9,93,10,0],[94,13,94,32,0],[95,13,95,32,0],[97,9,97,42,0],[98,9,98,10,0],[99,13,99,40,0],[101,9,101,28,0],[102,9,102,10,0],[103,13,103,88,0],[105,5,105,6,0]]);
    </script>
  </body>
</html>