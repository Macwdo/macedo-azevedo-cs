<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/home/macwdo/Work/MacedoAzevedo/Macedo-azevedo-cs/Ma.Api.Test/Extensions/MoqExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Net;
using System.Text.Json;
using Moq;
using Moq.Language.Flow;
using Moq.Protected;

namespace Ma.Api.Test.Extensions;

public static class MoqExtensions
{
    public static ISetup&lt;HttpMessageHandler, Task&lt;HttpResponseMessage&gt;&gt; SetupSendAsync(
        this Mock&lt;HttpMessageHandler&gt; handler,
        HttpMethod requestMethod,
        string requestUri
    )
    {
        return handler.Protected().Setup&lt;Task&lt;HttpResponseMessage&gt;&gt;(&quot;SendAsync&quot;,
            ItExpr.Is&lt;HttpRequestMessage&gt;(r =&gt;
                r.Method == requestMethod &amp;&amp;
                r.RequestUri != null &amp;&amp;
                r.RequestUri.ToString() == requestUri

            ),
            ItExpr.IsAny&lt;CancellationToken&gt;()
        );
    }

    public static IReturnsResult&lt;HttpMessageHandler&gt; ReturnsHttpResponseAsync(
        this ISetup&lt;HttpMessageHandler, Task&lt;HttpResponseMessage&gt;&gt; moqSetup,
        object? responseBody,
        HttpStatusCode responseCode
    )
    {
        var serializedResponse = JsonSerializer.Serialize(responseBody);
        var stringContent = new StringContent(serializedResponse ?? string.Empty);

        var responseMessage = new HttpResponseMessage()
        {
            Content = stringContent,
            StatusCode = responseCode
        };

        return moqSetup.ReturnsAsync(responseMessage);


    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,5,16,6,0],[17,9,25,11,0],[26,5,26,6,0],[33,5,33,6,0],[34,9,34,73,0],[35,9,35,83,0],[37,9,41,11,0],[43,9,43,55,0],[46,5,46,6,0]]);
    </script>
  </body>
</html>